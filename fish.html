<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/site.css">
    
    <title>Fish</title>
    <script src="js/gyronorm.complete.min.js"></script>
    <script src="js/fish.js"></script>
    
  </head>
  <body>

    <div class="container">
      <div id="message"><h2>Reading your mind ... </h2></div>
      <div class="reading">
        <div class="notflat" style="display:none;">Please place me on the flat on your hand</div>
        <div class="flat" id="reading-result" style="display:none;">
        </div>
      </div>

      <div class="available-readings">
        <div class="flat">
          <table class="table table-sm table-bordered">
              <thead>
                <tr>
                  <th>Movement</th>
                  <th>Interpretation</th>
                </tr>
              </thead>
              <tbody id="available-readings-list">
              </tbody>
          </table>
        </div>
      </div>  
    </div>


<template id="item-template">
  <tr>
    <td>Head and Tail</td>
    <td>You know fish</td>
  </tr>
</template>
<script>

  var fish = new Fish('available-readings-list', 'reading-result', fishConfig);

  var gn = new GyroNorm();
  var angle = 10;
  if (typeof DeviceOrientationEvent.requestPermission === 'function') {
    // iOS 13+
    DeviceOrientationEvent.requestPermission()
    .then(response => {
    if (response == 'granted') {
      start();
    }
    })
    .catch(console.error)

  } else {
    start();
  }

  function start() {

    fish.init();

      gn.init().then(function(){
      gn.start(function(data){

          $('#message').html('');

          /*
          $('#alpha').html(data.do.alpha);
          $('#beta').html(data.do.beta);
          $('#gamma').html(data.do.gamma);
          */

          if (data.do.beta < angle && data.do.beta > (angle * -1) &&
          data.do.gamma < angle && data.do.gamma > (angle * -1)
          ) {
              $('.notflat').hide();
              $('.flat').show();
          } else { 
              $('.notflat').show();
              $('.flat').hide();
          }
          // Process:
          // data.do.alpha	( deviceorientation event alpha value )
          // data.do.beta		( deviceorientation event beta value )
          // data.do.gamma	( deviceorientation event gamma value )
          // data.do.absolute	( deviceorientation event absolute value )

          // data.dm.x		( devicemotion event acceleration x value )
          // data.dm.y		( devicemotion event acceleration y value )
          // data.dm.z		( devicemotion event acceleration z value )

          // data.dm.gx		( devicemotion event accelerationIncludingGravity x value )
          // data.dm.gy		( devicemotion event accelerationIncludingGravity y value )
          // data.dm.gz		( devicemotion event accelerationIncludingGravity z value )

          // data.dm.alpha	( devicemotion event rotationRate alpha value )
          // data.dm.beta		( devicemotion event rotationRate beta value )
          // data.dm.gamma	( devicemotion event rotationRate gamma value )
      });
      }).catch(function(e){
          // Catch if the DeviceOrientation or DeviceMotion is not supported by the browser or device
          $('#message').html('');
          $('.notflat').hide();
          $('.flat').show();
                  
      });
  }
</script>

  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
  </body>
</html>